\section{theory}
\subsection{Centrifuge properties}

The present work uses the analytical solution by R\"aetz \cite{raetz.phd} of the
differential equation for the gas centrifuge as described in \cite{glaser.2008}.
Centrifuge parameters, such as average gas temperature, $T$, peripheral speed,
$v$, height, $h$, diameter, $d$, pressure ratio, $x$, feed flow rate, $F$,
counter-current flow ratio, $L/P$, and efficiency, $e$ have been chosen (Table
\ref{tab:centrifuges}) to match the cascade design describe in
\cite{glaser.2008} and \cite{walker.2017}.  These parameters for a P1-type
centrifuge are used to estimate the JCPOA-compliant IR-1 centrifuge.

\begin{table}[htb]
\centering
\caption{Summary of the centrifuge parameters.}
\begin{tabular}{cccccccc}
\toprule
$T$[K] & $v$[m/s]    & $h$[m] & $d$[m]   & $x$   & $F$[mg/s]  & $L/F$ & $e$  \\
\midrule
320    & $320$           & $1.8$ & $0.105$ & $1e3$  & $13$      & 2     & 1.0  \\
\bottomrule
\end{tabular}

  \label{tab:centrifuges}
\end{table}

\subsection{Cascade Design}

The cascade is built as an ideal cascade, with no losses in the separative work,
which corresponds to $\alpha =\beta = const$ for all stage of the cascade, where
$\alpha$ and $\beta$ respectively represent the feed to product and the feed to
tail enrichment factors.  $\alpha$ and $\beta$ can be expressed as function of
the abundance ($R$) or the enrichment ($N$) of respectively the product
($R'$,$N'$) and the feed,($R$,$N$) and the feed and the tails ($R''$,$N''$) such
as:
\begin{subequations} \label{eqs:alphabeta}
    \begin{equation} \label{eq:alpha_def}
        \alpha = \frac{R'}{R} = \frac{N'}{1-N'}\frac{1-N}{N} 
\end{equation}
\\
\begin{equation}\label{eq:beta-def}
        \beta = \frac{R}{R''} = \frac{N}{1-N}\frac{1-N''}{N''} 
\end{equation}
\end{subequations}

As detailed in \cite{avery} it is also possible to derive $\alpha$ from the
first principle, and express it as a function of the feed rate $F$ the
separative performance $\delta U(\theta)$, the cut $\theta$:

    \begin{equation} \label{eq:alpha}
    \alpha = \sqrt{\frac{2\delta U}{F} \frac{1-\theta}{\theta}}+1
\end{equation}

From the mass conservation, $N = \theta N' + (1-\theta)N''$, and equations
\eqref{eqs:alphabeta} it is possible to express $\beta$ as a function of the
feed abundance, $R$, the cut $\theta$ and $\alpha$:

\begin{equation}\label{eq:beta}
    \beta =   R \left(\dfrac{1-\theta}
                     {\dfrac{R}{R+1}- \theta \dfrac{\alpha R}{1+\alpha R}} -1\right)
\end{equation}


From equation \eqref{eq:alpha} and \eqref{eq:beta} it is possible to determine
the cut, $\theta$, or the ratio of product flow to feed flow required to build an ideal
cascade:
$\beta$ values and the feed assay, $N_{i}$:
\begin{eqnarray}
    \theta_{i} = \dfrac{N_{i} - \dfrac{1}{1 + \beta/R_{i}}}{ \dfrac{\alpha R_{i}}{1 + \alpha R_{i}} -
           \dfrac{1}{1 + \beta/R_{i}}}
\end{eqnarray}

Since $\alpha_{i}$ and $\beta_{i}$ remain constant, only the value of the cut,
$\theta_{i}$, changes in each stage $i$ of a cascade.  This algorithm assumes
that the corresponding separative power $\delta U$ (not re-computed) can be
achieved with the chosen centrifuge design, tuning other operational parameter
such as the rotation speed, the counter-current flow ratio...  Once $\theta_{i}$
is determined, it is possible to compute the product and the tail assay.

The design of the cascade is performed through 2 steps.  First one determines the
configuration and number of stages, adding stages until the product assay of the
final stage is greater than or equal to than the desired assay, and the tails
assay is similarly less than or equal to the desired tails assay.  This
determines the number of enriching and stripping stages as well as their
enrichment properties ($N_{i}$, $N'_{i}$, $N''_{i}$,$\theta_{i}$i).


The second step determines how to populate the cascade with the user-defined
maximum number of centrifuges.  

One solves the linear flow equation, \eqref{eq:flow}, to determine the
theoretical flow in the cascade.

\begin{equation}
\setcounter{MaxMatrixCols}{20}
\begin{bmatrix}
     -1        & 1-\theta_{_{S+1}} & 0 & ...  & 0              & 0              & 0                 & 0                 & 0                 & ...  & 0               & 0 \\
 \theta_{_{S}} & -1                & 0 & ...  & 0              & 0              & 0                 & 0                 & 0                 & ...  & 0               & 0 \\
               &                   &   &     &                &                & ...               &                   &                   &     &                 &   \\
 0             & 0                 & 0 & ...  & \theta_{_{-2}} & -1             & 1 - \theta_{_{0}} & 0                 & 0                 & ...  & 0               & 0 \\
 0             & 0                 & 0 & ...  & 0              & \theta_{_{-1}} & -1                & 1 - \theta_{_{1}} & 0                 & ...  & 0               & 0 \\
 0             & 0                 & 0 & ...  & 0              & 0              & \theta_{_{0}}     & -1                & 1 - \theta_{_{2}} & 0   & ...             & 0 \\
               &                   &   &     &                &                & ...               &                   &                   &     &                 &   \\
 0             & 0                 & 0 & ...  & 0              & 0              & 0                 & 0                 & 0                 & ...  & -1              & 1-\theta_{_{E}} \\
 0             & 0                 & 0 & ...  & 0              & 0              & 0                 & 0                 & 0                 & ...  & \theta_{_{E-1}} & -1
 \end{bmatrix}
 \times
 \begin{bmatrix}
     F_{_{S}}   \\
     F_{_{S+1}} \\
     \cdots     \\
     F_{_{-1}}  \\
     F_{_{0} }  \\
     F_{_{1} }  \\
     \cdots     \\
     F_{_{E-1}} \\
     F_{_{E}}
 \end{bmatrix}
 =
 \begin{bmatrix}
     0      \\
     0      \\
     \cdots \\
     0      \\
     F      \\
     0      \\
     \cdots \\
     0      \\
     0
\end{bmatrix}
%\caption{caption needed!}
\label{eq:flow}
\end{equation}

Once the relative flow of each stage has been determined, the cascade can be
populated with actual machines up the stages until the maximum number available
of machines is reached.


\subsection{Miss-use models}
Little information is available about optimising an existing enrichment cascade
that is being fed with a feed enrichment that does not match the design one. So
far 3 different methods have been investigated, the first one assumes that no
change are been made on the cascade, the second one, assumes that the cut value
at each stage is retuned to maintain the ideal state of the cascade, the last
one, described in \cite{walker.2017} assumes the tails to product enriching
factor remains constants ($\gamma = \alpha\times\beta$). Models behavior, and
assumptions are summarized in Tab. \ref{tab:models}.

\begin{table}[htb]
\centering
  \caption{Summary of miss-use model properties.}
\begin{tabular}{l|ccc}
\toprule

Model                &    A                 & B                  & C  \\
\midrule
Constant parameters  & $\alpha_i, \theta_i$ & $\alpha_i=\beta_i$ & $\gamma_i=\alpha_i*\beta_i, \theta_i$       \\
Optimised parameters & $\beta_i$            & $\theta_i$         & $\alpha_i, \beta_i$                     \\
Assays determination & blended              & ideal              & blended                  \\
Flow                 & unchanged            & scaled             & unchanged       \\

\bottomrule
\end{tabular}
  \label{tab:models}
\end{table}

\subsubsection{Case A}
The tuning method A does not re-optimize $\theta_i$ based on the true flow
enrichment. As $\delta U$ and $\alpha$ do not depend on the stage feed assay
($N'$), they do not change from stage to stage. According to equation
\eqref{eq:beta}, when $\alpha$ and $\theta$ are fixed, when the feed assay ($N$)
changes, then $\beta$ will change accordingly.  This breaks the ideal status of
the cascade, i.e.  $N_{i} \neq N'_{i-1} \neq N''_{i+1}$.

In order to compute the proper product and tails assay at each stage, the
tails and the product from respectively the next and the previous stage must be
blended in order to determine the correct stage feed assay. As this is a obvious
cycling problem, an iterative solution has been chosen: all feed assays are
iteratively updated, blending the proper product and tails, then using the
updated feed assay, the new product and tail assays are recomputed. This process
is repeated until the change in assays is smaller than the set precision (1e-8
by default).
As the cut remain fixed at each stage the different flow do not need to be
recomputed.


\subsubsection{Case B}

The second method the cut value at each stage $\theta_i$, is retuned in order to
maintain the $\alpha_i$ and $\beta_i$ at their original values. As the cascade
remains ideal, the product and tail assay at each stages (and for the overall
cascade) is easily determined using equations \eqref{eqs:alphabeta}.

As the cuts values change, the flow rate between the different stage has to be
recomputed. Because the cascade is not reorganised (the number of cascade per
stage remain the same as the original design). The new flow rate are computed as
the flow rates of the reconfigured cascade scaled down by the possible
flows of the original one: the flow rates of a reconfigured cascade are
computed, the ratios of the flow stage by stage with the original are determined,
the smaller ratio is used to scale down all the flow rates.

\subsubsection{Case C}
The last model assumes that the tail to product enrichment factor remains
constant regardless to the feed assays. To compute the response of the cascade
one need to determine $\alpha$ and $\beta$ such as their product and
$\theta$ remain fixed. 
From equations \eqref{eqs:alphabeta} and the assay conservation equation $N =
\theta N' + (1-\theta)N''$ it is possible to express the product $N'$ as a function of
the feed assay $N$, $\gamma$ and the cut $\theta$ as one solution of the second
order equation \eqref{eq:gamma_p}:

\begin{equation}\label{eq:gamma_p}
\gamma(1-N')(P\theta-N) - N'(1-(N'\theta-N)/(-1+\theta))(-1+\theta) = 0
\end{equation}

The only solution allowing product assay values ranging between 0 and 1 is the
following :
\begin{equation}\label{eq:model_b_sol}
    \frac{\gamma(N + \theta) - N 
            - \sqrt{\gamma^2(N^2 
                            - 2N\theta 
                            + \theta^2) 
                    - \gamma(2N^2 - 2\theta^2 
                            + 2N + 2\theta) 
                    + N^2 + 2N\theta + \theta^2 - 2N - 2\theta + 1} 
            - \theta + 1}
        {2\theta(\gamma - 1)}
\end{equation}
Once the product assay is known, one can trivially determine the tail assay,
$\alpha$ and $\beta$ using equations \eqref{eqs:alphabeta} and mass
conservation.

Similarly as model A, because the cut values remain constant, the flows don't
need to be recomputed, and the correct assays, $\alpha$ and $\beta$ are
determined through iterative blending of the product assays of the previous
stage and the tails assay of the next stage using equation
\eqref{eq:model_b_sol}.


